/*

    Copyright (C) 2014 Dave Lesage
    License: MIT
    See license.txt for full license text.
*/
(function(h,p){var a=h.util||{},c=function(){function a(b){this.xStack=[];this.yStack=[];this.count=0;this.maxStackDepth=b}a.prototype.push=function(a,b){this.xStack.push(a);this.yStack.push(b);this.count++};a.prototype.pop=function(){this.xStack.pop();this.yStack.pop();this.count--};return a}();a.getType=function(a){return Object.prototype.toString.call(a).match(/^\[object (.+)\]$/)[1]};a.assert=function(b,d){var c=arguments.callee.caller;if(a.getType(b)===a.types["function"]){if(!b()){if(d)throw Error(d);
c=b.toString();c=c.substring(c.indexOf("{")+1,c.lastIndexOf("}")).trim();throw Error("Assertion failed: "+c);}}else if(a.getType(b)===a.types.string){if(b=a.lambda(b).bind(c),!b()){if(d)throw Error(d);c=b.toString();c=c.substring(c.indexOf("{")+1,c.lastIndexOf("}")).trim();throw Error("Assertion failed: "+c);}}else if(!b){if(d)throw Error(d);throw Error("Assertion failed: "+String(b));}};a.deepCopy=function(b){function d(a,b){f=g.xStack.indexOf(a);if(-1===f){g.push(a,b);for(var c in a)b[c]=e(a[c]);
g.pop();return b}return g.yStack[f]}function e(b){if(g.count>g.maxStackDepth)throw Error("Stack depth exceeded: "+g.stackMaxDepth+"!");switch(a.getType(b)){case a.types.object:return d(b,Object.create(b));case a.types.array:for(var c=[],f=0;f<b.length;f++)c[f]=e(b[f]);return c;case a.types.regexp:return d(b,new RegExp(b));case a.types.date:return d(b,new Date(b.toString()));default:return b}}var f=-1,g=new c(1E3);return e(b)};a.defineProperty=function(a,c,e){null==a[c]?Object.defineProperty(a,c,e):
console.error("Error: the method "+c+" has already been defined on the following object: "+a)};a.equals=function(b,d){function e(a,b){var c=Object.keys(a),d=Object.keys(b);c.quicksort();d.quicksort();if(!f(c,d))return!1;g.push(a,b);for(var e in a)if(!f(a[e],b[e]))return!1;g.pop();return!0}function f(b,c){if(g.count>g.maxStackDepth)throw Error("Stack depth exceeded: "+g.maxStackDepth+"!");if(b===c)return!0;var d=a.getType(b),h=a.getType(c);if(d!==h)return!1;if(-1!==g.xStack.indexOf(b)&&-1!==g.yStack.indexOf(c))return!0;
switch(d){case "Date":if(b.getTime()!==c.getTime()||!e(b,c))return!1;break;case "Function":if(b.toString()!==c.toString())return!1;break;case "Array":if(b.length!==c.length)return!1;g.push(b,c);for(d=0;d<b.length;d++)if(!f(b[d],c[d]))return!1;g.pop();break;case "Object":case "RegExp":if(!e(b,c))return!1;break;default:if(b!==c)return!1}return!0}var g=new c(1E3);return f(b,d)};a.sizeof=function(a){var c=[];a=[a];for(var e=0;a.length;){var f=a.pop();if("boolean"===typeof f)e+=4;else if("string"===typeof f)e+=
2*f.length;else if("number"===typeof f)e+=8;else if("object"===typeof f&&-1===c.indexOf(f))for(i in c.push(f),f)a.push(f[i])}return e};a.smash=function(){var b=Array.prototype.slice.call(arguments);if(0>=b.length)return null;if(1===b.length)return b[0];for(var c={},e=0;e<b.length;e++){var f=b[e];a.check.isObject(f);for(var g in f)null==c[g]?c[g]=a.deepCopy(f[g]):a.getType(c[g])===a.types.object&&(c[g]=a.smash(c[g],f[g]))}return c};a.lambda=function(b){if(null==b)return a.functions.identity;if(a.getType(b)===
a.types["function"])return b;if(a.getType(b)===a.types.string){if(a.equals(b,""))return a.functions.identity;if(-1<b.indexOf("=>")){var c=b.match(a.functions.matcher);return(new Function(c[1]||[],"return "+c[2]+";")).bind(arguments.callee.caller)}}return function(c){return a.equals(b,c)}};(function(){a.functions={identity:function(a){return a},"true":function(a){return!0},"false":function(a){return!1},empty:function(a){},matcher:/^(?:[(\s*]*)?(\w+(?:,\s*\w+)*)?(?:[)\s*]*)?=>(?:\s*)?(.*)$/};a.types=
{array:a.getType([]),"boolean":a.getType(!0),date:a.getType(new Date),"function":a.getType(function(){}),"null":a.getType(null),number:a.getType(0),object:a.getType({}),string:a.getType(""),regexp:a.getType(RegExp()),undefined:a.getType(p)}})();h.util=a})(window||this);
(function(h,p){var a=h.util||{};a.defineProperty(Array.prototype,"aggregate",{enumerable:!1,writable:!1,value:function(c,b){a.check.exists(c);a.getType(c)===a.types.string&&(c=a.lambda(c));a.assert("() => this.length > 0");var d;d=null==b?this[0]:c(b,this[0]);for(var e=1;e<this.length;e++)d=c(d,this[e]);return d}});a.defineProperty(Array.prototype,"any",{enumerable:!1,writable:!1,value:function(c){if(null==c)return 0<this.length;c=a.lambda(c);for(var b=0;b<this.length;b++)if(c(this[b]))return!0;return!1}});
a.defineProperty(Array.prototype,"average",{enumerable:!1,writable:!1,value:function(a){return this.sum(a)/this.length}});a.defineProperty(Array.prototype,"contains",{enumerable:!1,writable:!1,value:function(c,b){if(null==b)for(var d=0;d<this.length;d++){if(a.equals(this[d],c))return!0}else for(b=a.lambda(b),d=0;d<this.length;d++)if(a.equals(c,b(this[d])))return!0;return!1}});a.defineProperty(Array.prototype,"deepCopy",{enumerable:!1,writable:!1,value:function(){return a.deepCopy(this)}});a.defineProperty(Array.prototype,
"distinct",{enumerable:!1,writable:!1,value:function(c){var b=[];if(null==c)for(var d=0;d<this.length;d++)b.contains(this[d])||b.push(this[d]);else for(c=a.lambda(c),d=0;d<this.length;d++)b.contains(c(this[d]),c)||b.push(this[d]);return b.deepCopy()}});a.defineProperty(Array.prototype,"equals",{enumerable:!1,writable:!1,value:function(c){return a.equals(this,c)}});a.defineProperty(Array.prototype,"first",{enumerable:!1,writable:!1,value:function(c){if(null==c){if(0<this.length)return this[0]}else{c=
a.lambda(c);for(var b=0;b<this.length;b++)if(c(this[b]))return this[b]}return null}});a.defineProperty(Array.prototype,"innerJoin",{enumerable:!1,writable:!1,value:function(c){a.check.isNonEmptyArray(c);var b=this;return{on:function(d){var e=[];d=a.lambda(selector);for(var f=0;f<d.length;f++){a.check.isObject(b[f]);for(var g=0;g<c.length;g++)a.check.isObject(c[g]),d(b[f],c[g])&&e.push(a.smash(b[f],c[g]))}return e}}}});a.defineProperty(Array.prototype,"last",{enumerable:!1,writable:!1,value:function(c){if(null==
c){if(0<this.length)return this[this.length-1]}else{c=a.lambda(c);for(var b=this.length-1;0<=b;b--)if(c(this[b]))return this[b]}return null}});a.defineProperty(Array.prototype,"max",{enumerable:!1,writable:!1,value:function(c){var b=Number.MIN_VALUE;if(null!=c){c=a.lambda(c);for(var d=0;d<this.length;d++){var e=c(this[d]);a.check.isNumber(e)&&b<e&&(b=e)}}else for(d=0;d<this.length;d++)e=this[d],a.check.isNumber(e)&&b<e&&(b=e);return b}});a.defineProperty(Array.prototype,"min",{enumerable:!1,writable:!1,
value:function(c){var b=Number.MAX_VALUE;if(null!=c){c=a.lambda(c);for(var d=0;d<this.length;d++){var e=c(this[d]);a.check.isNumber(e)&&e<b&&(b=e)}}else for(d=0;d<this.length;d++)e=this[d],a.check.isNumber(e)&&e<b&&(b=e);return b}});a.defineProperty(Array.prototype,"orderBy",{enumerable:!1,writable:!1,value:function(c,b){c=a.lambda(c);b=b||function(a,b){return c(a)>c(b)?1:c(a)<c(b)?-1:0};var d=this.where(function(a){return null!=c(a)}),e=this.where(function(a){return null==c(a)});d.quicksort(b);return d.concat(e)}});
a.defineProperty(Array.prototype,"quicksort",{enumerable:!1,writable:!1,value:function(c){var b=this;c=a.getType(c)===a.types.string?a.lambda(c):c||function(a,b){return a>b?1:a<b?-1:0};var d=function(a,f){do{var g=a,k=f,l=b[Math.floor((a+f)/2)];do{for(;g<b.length&&0>c(b[g],l);)g++;for(;0<=k&&0>c(l,b[k]);)k--;if(g>k)break;g<k&&b.swap(g,k);g++;k--}while(g<=k);k-a<=f-g?(a<k&&d(a,k),a=g):(g<f&&d(g,f),f=k)}while(a<f)};d(0,this.length-1)}});a.defineProperty(Array.prototype,"quicksort3",{enumerable:!1,writable:!1,
value:function(c){var b=this;c=a.getType(c)===a.types.string?a.lambda(c):c||function(a,b){return a>b?1:a<b?-1:0};var d=function(a,f){for(var g=a,k=f,l=b[a],h=a+1;h<=k;){var m=c(b[h],l);0>m?b.swap(g++,h++):0<m?b.swap(h,k--):h++}a<g-1&&d(a,g-1);k+1<f&&d(k+1,f)};d(0,this.length-1)}});a.defineProperty(Array.prototype,"removeAll",{enumerable:!1,writable:!1,value:function(c){var b=0;c=a.lambda(c);for(var d=this.length-1;-1<d;d--)c(this[d])&&(this.splice(d,1),b++);return b}});a.defineProperty(Array.prototype,
"select",{enumerable:!1,writable:!1,value:function(c){var b=[];c=a.lambda(c);for(var d=0;d<this.length;d++)b.push(c(this[d]));return b.deepCopy()}});a.defineProperty(Array.prototype,"skip",{enumerable:!1,writable:!1,value:function(c){var b=this;a.assert(function(){return 0<c&&c<=b.length});for(var d=[],e=0;e<b.length-c;e++)d[e]=b[e+c];return d.deepCopy()}});a.defineProperty(Array.prototype,"sum",{enumerable:!1,writable:!1,value:function(c){var b=0;if(null!=c){c=a.lambda(c);for(var d=0;d<this.length;d++){var e=
c(this[d]);a.check.isNumber(e)&&(b+=e)}}else for(d=0;d<this.length;d++)a.check.isNumber(this[d])&&(b+=this[d]);return b}});a.defineProperty(Array.prototype,"swap",{enumerable:!1,writable:!1,value:function(a,b){var d=this[a];this[a]=this[b];this[b]=d}});a.defineProperty(Array.prototype,"take",{enumerable:!1,writable:!1,value:function(c){var b=this;a.assert(function(){return 0<c&&c<=b.length});for(var d=[],e=0;e<c;e++)d[e]=b[e];return d.deepCopy()}});a.defineProperty(Array.prototype,"takeWhile",{enumerable:!1,
writable:!1,value:function(c){var b=[];c=a.lambda(c);for(var d=0;d<count&&c(this[d]);d++)b.push(this[d]);return b.deepCopy()}});a.defineProperty(Array.prototype,"where",{enumerable:!1,writable:!1,value:function(c){c=a.lambda(c);for(var b=[],d=0;d<this.length;d++)c(this[d])&&b.push(this[d]);return b.deepCopy()}});h.util=a})(window||this);
(function(h,p){var a=h.util||{},c=function(){};c.argsNotNull=function(){a.assert(function(){for(var a=0;a<arguments.length;a++)if(null==arguments[a])return!1;return!0});return!0};c.exists=function(b){a.assert(function(){return null!=b});return!0};c.isArray=function(b){a.assert(function(){return a.getType(b)===a.types.array});return!0};c.isBoolean=function(b){a.assert(function(){return a.getType(b)===a.types["boolean"]});return!0};c.isFunction=function(b){a.assert(function(){return a.getType(b)===
a.types["function"]});return!0};c.isNonEmptyArray=function(b){a.assert(function(){return null!=b&&a.getType(b)===a.types.array&&0<b.length})};c.isNumber=function(b){a.assert(function(){return!isNaN(b)});return!0};c.isObject=function(b){a.assert(function(){return a.getType(b)===a.types.object});return!0};c.isReference=function(b){a.assert(function(){a.getType(b);return valType===a.types.object||valType===a.types.array||valType===a.types.date||valType===a.types.regexp||valType===a.types["function"]});
return!0};c.isString=function(b){a.assert(function(){return a.getType(b)===a.types.string});return!0};c.isType=function(b,c){a.assert(function(){return a.getType(b)===c});return!0};c.isValue=function(b){a.assert(function(){var c=a.getType(b);return c===a.types.string||c===a.types["boolean"]||c===a.types.number||c===a.types["null"]||c===a.types.undefined});return!0};a.check=c;h.util=a})(window||this);
(function(h,p){var a=h.util||{},c={},b;c.build=function(b){a.check.isObject(b);a.check.isArray(b.Tables);b=b.Tables.orderBy("x => x.TableName");for(var e=0;e<b.length;e++)c.makeTable(b[e])};c.makeTable=function(d){a.check.isObject(d);a.check.isString(d.TableName);a.check.isArray(d.PrimaryKeys);a.check.isArray(d.ForeignKeys);var e=[],f=[],g=[],k=[];switch(b){case "sqlite":e.push("CREATE TABLE IF NOT EXISTS "+d.TableName+" (");for(var h=0;h<d.Columns.length;h++){var n=d.Columns[h],m=c.types[n.DataType][b],
m=m.length?m.type+"("+m.length+")":m.type;0===h?f.push("    "+n.ColumnName+" "+m+(n.IsNullable?"":" NOT NULL")):f.push(n.ColumnName+" "+m+(n.IsNullable?"":" NOT NULL"))}f=f.join("\n    , ");e.push(f);k.push("    , PRIMARY KEY (");for(h=0;h<d.PrimaryKeys.length;h++)g.push(d.PrimaryKeys[h].ColumnName);k.push(g.join(", "));k.push(")");d=k.join("");e.push(d);e.push(")");e.join("\n")}};c.load=function(c,e,f){a.check.isString(c);a.check.isString(e);a.check.isNumber(f);b=e.toLowerCase();switch(b){case "sqlite":openDatabase(c,
"0.1",c,f)}};c.types={bit:{sqlite:{type:"INTEGER"}},"char":{sqlite:{type:"TEXT"}},datetime:{sqlite:{type:"TEXT"}},datetime2:{sqlite:{type:"TEXT"}},decimal:{sqlite:{type:"REAL"}},"float":{sqlite:{type:"REAL"}},"int":{sqlite:{type:"INTEGER"}},money:{sqlite:{type:"REAL"}},nvarchar:{sqlite:{type:"TEXT"}},smallint:{sqlite:{type:"INTEGER"}},smallmoney:{sqlite:{type:"REAL"}},text:{sqlite:{type:"TEXT"}},tinyint:{sqlite:{type:"INTEGER"}},varchar:{sqlite:{type:"TEXT"}},uniqueidentifier:{sqlite:{type:"CHAR",
length:36},mssql:{type:"uniqueidentifier"}}};a.db=c;h.util=a})(window||this);
(function(h,p){var a=h.util||{};a.classes=a.classes||{};var c=function(){return function(){var b=[],c=function(a){var c=b[a];if(null!=c)for(var d=0;d<c.length;d++){var e=c[d];null!=e.func&&e.func.apply(null,Array.prototype.slice.call(arguments,1))}},e=function(c){a.check.exists(c);b[c]=null},f=function(c,d){a.check.exists(c);a.check.isFunction(d);var e=b[c]||(b[c]=[]),f={func:d};e.push(f);return function(){b[c].removeAll(function(a){return a===f})}};return function(b){a.defineProperty(b,"call",{get:function(){return c},
writeable:!1});a.defineProperty(b,"clear",{get:function(){return e},writeable:!1});a.defineProperty(b,"on",{get:function(){return f},writeable:!1});return b}({})}}();a.classes.Events=c;a.events=new a.classes.Events;h.util=a})(window||this);
(function(h,p){var a=h.util||{},c=/\+/g,b=function(b){a.defineProperty(b,"parameters",{get:function(){var a={},b=window.location.href,d=b.indexOf("?");if(-1<d)for(b=b.substring(d+1).split("&"),d=0;d<b.length;d++){var h=b[d].split("=");2==h.length&&(a[h[0]]=decodeURIComponent(h[1].replace(c," ")))}return a},writeable:!1});return b}({});a.location=b;h.util=a})(window||this);
(function(h,p){var a=h.util||{};a.classes=a.classes||{};var c=["debug","error","info","log","warn"],b=function(){return function(b,e){var f,g,h,l,n,m,q=function(b){if(a.getType(b)===a.types.string)a:switch(b.toLowerCase().trim()){case "false":case "0":case "":case null:case p:b=!1;break a;default:b=!0}m=!!b},r;(r=function(b){a.check.exists(b);for(var d=0;d<c.length;d++)a.check.isFunction(b[c[d]]);f=b.debug.bind(b);g=b.error.bind(b);h=b.info.bind(b);l=b.log.bind(b);n=b.warn.bind(b);q(null!=e?e:a.location?
a.location.parameters.debug:!1)})(b);return function(b){a.defineProperty(b,"debug",{get:function(){return m?f:a.functions.empty},writeable:!1});a.defineProperty(b,"error",{get:function(){return g},writeable:!1});a.defineProperty(b,"info",{get:function(){return h},writeable:!1});a.defineProperty(b,"log",{get:function(){return l},writeable:!1});a.defineProperty(b,"warn",{get:function(){return n},writeable:!1});a.defineProperty(b,"setDebugLogging",{get:function(){return q},writeable:!1});a.defineProperty(b,
"setLogger",{get:function(){return r},writeable:!1});return b}(l)}}();a.classes.LogInterface=b;a.log=new a.classes.LogInterface(console);h.util=a})(window||this);
(function(h,p){var a=h.util||{};a.match=function(c,b){var d=[];if(!b||a.getType(b)!==a.types.object||!c||a.getType(c)!==a.types.array||1>c.length)return d;var e=Object.keys(b).length;if(1>e)return d;for(var f,g=0;g<c.length;g++){f=0;for(var h in b){var l;l=c[g][h];var n=b[h];if(a.getType(l)===a.types.array){a.getType(n)!==a.types.array&&(n=[n]);b:{for(var m=0;m<n.length;m++)if(!l.contains(n[m])){l=!1;break b}l=!0}}else l=l===n;l&&f++}f===e&&d.push(c[g])}return d};h.util=a})(window||this);
(function(h,p){var a=h.util||{};a.defineProperty(Object.prototype,"deepCopy",{enumerable:!1,writable:!1,value:function(){return a.deepCopy(this)}});a.defineProperty(Object.prototype,"defineProperty",{enumerable:!1,writable:!1,value:function(c,b){return a.defineProperty(this,b)}});a.defineProperty(Object.prototype,"equals",{enumerable:!1,writable:!1,value:function(c){return a.equals(this,c)}});a.defineProperty(Object.prototype,"smash",{enumerable:!1,writable:!1,value:function(){var c=Array.prototype.slice.call(arguments);
c.unshift(this);return a.smash.apply(this,c)}});h.util=a})(window||this);
(function(h,p){function a(a){var d=new c,g=a||"";this.stop=function(){d.stop();b.log.debug(g+" took: "+d.duration()+" ms")};d.start()}function c(){var a=null,b=null,c=!1;this.start=function(){c||(b=null,c=!0,a=(new Date).getTime())};this.stop=function(){c&&(b=(new Date).getTime(),c=!1)};this.duration=function(){return c?(new Date).getTime()-a:b-a};this.reset=function(){c=!1;b=a=null}}var b=h.util||{};b.classes=b.classes||{};var d=function(){return function(){var c=[],d=function(b){c.push(new a(b))},
g=function(){0<c.length&&c.pop().stop()};return function(a){b.defineProperty(a,"push",{get:function(){return d},writeable:!1});b.defineProperty(a,"pop",{get:function(){return g},writeable:!1});return a}({})}}();b.classes.StopwatchStack=d;b.classes.StopwatchWrapper=a;b.classes.Stopwatch=c;b.sw=new b.classes.StopwatchStack;h.util=b})(window||this);
