/*

 Copyright (C) 2014 Dave Lesage
 License: MIT
 See license.txt for full license text.
*/
(function(g,q){var a=g.util||{},e=function(n,b){a.check.exists(n);a.getType(n)===a.types.string&&(n=a.lambda(n));a.assert("() => this.length > 0");var c;c=null==b?this[0]:n(b,this[0]);for(var d=1;d<this.length;d++)c=n(c,this[d]);return c},b=function(n){if(null==n)return 0<this.length;n=a.lambda(n);for(var b=0;b<this.length;b++)if(n(this[b]))return!0;return!1},c=function(a){return this.sum(a)/this.length},d=function(n,b){if(null==b)for(var c=0;c<this.length;c++){if(a.equals(this[c],n))return!0}else for(b=
a.lambda(b),c=0;c<this.length;c++)if(a.equals(n,b(this[c])))return!0;return!1},f=function(){return a.deepCopy(this)},h=function(b){var c=[];if(null==b)for(var d=0;d<this.length;d++)c.contains(this[d])||c.push(this[d]);else for(b=a.lambda(b),d=0;d<this.length;d++)c.contains(b(this[d]),b)||c.push(this[d]);return c.deepCopy()},k=function(b){return a.equals(this,b)},r=function(b){if(null==b){if(0<this.length)return this[0]}else{b=a.lambda(b);for(var c=0;c<this.length;c++)if(b(this[c]))return this[c]}return null},
m=function(b){if(null==b){if(0<this.length)return this[this.length-1]}else{b=a.lambda(b);for(var c=this.length-1;0<=c;c--)if(b(this[c]))return this[c]}return null},p=function(b){var c=Number.MIN_VALUE;if(null!=b){b=a.lambda(b);for(var d=0;d<this.length;d++){var l=b(this[d]);a.check.isNumber(l)&&c<l&&(c=l)}}else for(d=0;d<this.length;d++)l=this[d],a.check.isNumber(l)&&c<l&&(c=l);return c},s=function(b){var c=Number.MAX_VALUE;if(null!=b){b=a.lambda(b);for(var d=0;d<this.length;d++){var l=b(this[d]);
a.check.isNumber(l)&&l<c&&(c=l)}}else for(d=0;d<this.length;d++)l=this[d],a.check.isNumber(l)&&l<c&&(c=l);return c},t=function(b,c){b=a.lambda(b);c=c||function(a,c){return b(a)>b(c)?1:b(a)<b(c)?-1:0};var d=this.where(function(a){return null!=b(a)}),l=this.where(function(a){return null==b(a)});d.quicksort(c);return d.concat(l)},u=function(b){var c=this;b=a.getType(b)===a.types.string?a.lambda(b):b||function(b,a){return b>a?1:b<a?-1:0};var d=function(a,f){do{var k=a,h=f,r=c[Math.floor((a+f)/2)];do{for(;k<
c.length&&0>b(c[k],r);)k++;for(;0<=h&&0>b(r,c[h]);)h--;if(k>h)break;k<h&&c.swap(k,h);k++;h--}while(k<=h);h-a<=f-k?(a<h&&d(a,h),a=k):(k<f&&d(k,f),f=h)}while(a<f)};d(0,this.length-1)},v=function(b){var c=this;b=a.getType(b)===a.types.string?a.lambda(b):b||function(a,b){return a>b?1:a<b?-1:0};var d=function(a,k){for(var h=a,f=k,r=c[a],e=a+1;e<=f;){var m=b(c[e],r);0>m?c.swap(h++,e++):0<m?c.swap(e,f--):e++}a<h-1&&d(a,h-1);f+1<k&&d(f+1,k)};d(0,this.length-1)},w=function(b){var c=[];b=a.lambda(b);for(var d=
0;d<this.length;d++)c.push(b(this[d]));return c.deepCopy()},x=function(b){var c=this;a.assert(function(){return 0<b&&b<=c.length});for(var d=[],k=0;k<c.length-b;k++)d[k]=c[k+b];return d.deepCopy()},y=function(b){var c=0;if(null!=b){b=a.lambda(b);for(var d=0;d<this.length;d++){var k=b(this[d]);a.check.isNumber(k)&&(c+=k)}}else for(d=0;d<this.length;d++)a.check.isNumber(this[d])&&(c+=this[d]);return c},z=function(b,a){var c=this[b];this[b]=this[a];this[a]=c},A=function(b){var c=this;a.assert(function(){return 0<
b&&b<=c.length});for(var d=[],k=0;k<b;k++)d[k]=c[k];return d.deepCopy()},B=function(b){b=a.lambda(b);for(var c=[],d=0;d<this.length;d++)b(this[d])&&c.push(this[d]);return c.deepCopy()};(function(){var a=function(a){null==a.proto[a.name]?Object.defineProperty(a.proto,a.name,{enumerable:!1,writable:!1,value:a.func}):console.error("Error: the method "+a.name+" has already been defined on the following prototype: "+a.proto)};a({proto:Array.prototype,name:"aggregate",func:e});a({proto:Array.prototype,
name:"any",func:b});a({proto:Array.prototype,name:"average",func:c});a({proto:Array.prototype,name:"contains",func:d});a({proto:Array.prototype,name:"deepCopy",func:f});a({proto:Array.prototype,name:"distinct",func:h});a({proto:Array.prototype,name:"equals",func:k});a({proto:Array.prototype,name:"first",func:r});a({proto:Array.prototype,name:"last",func:m});a({proto:Array.prototype,name:"max",func:p});a({proto:Array.prototype,name:"min",func:s});a({proto:Array.prototype,name:"orderBy",func:t});a({proto:Array.prototype,
name:"quicksort",func:u});a({proto:Array.prototype,name:"quicksort3",func:v});a({proto:Array.prototype,name:"select",func:w});a({proto:Array.prototype,name:"skip",func:x});a({proto:Array.prototype,name:"sum",func:y});a({proto:Array.prototype,name:"swap",func:z});a({proto:Array.prototype,name:"take",func:A});a({proto:Array.prototype,name:"where",func:B})})();g.util=a})(window||this);
(function(g,q){var a=g.util||{},e=function(){function a(b){this.xStack=[];this.yStack=[];this.count=0;this.maxStackDepth=b}a.prototype.push=function(a,b){this.xStack.push(a);this.yStack.push(b);this.count++};a.prototype.pop=function(){this.xStack.pop();this.yStack.pop();this.count--};return a}();a.getType=function(a){return Object.prototype.toString.call(a).match(/^\[object (.+)\]$/)[1]};a.assert=function(b,c){var d=arguments.callee.caller;if(a.getType(b)===a.types["function"]){if(!b()){if(c)throw Error(c);
d=b.toString();d=d.substring(d.indexOf("{")+1,d.lastIndexOf("}")).trim();throw Error("Assertion failed: "+d);}}else if(a.getType(b)===a.types.string){if(b=a.lambda(b).bind(d),!b()){if(c)throw Error(c);d=b.toString();d=d.substring(d.indexOf("{")+1,d.lastIndexOf("}")).trim();throw Error("Assertion failed: "+d);}}else if(!b){if(c)throw Error(c);throw Error("Assertion failed: "+String(b));}};a.deepCopy=function(b){function c(a,b){f=h.xStack.indexOf(a);if(-1===f){h.push(a,b);for(var c in a)b[c]=d(a[c]);
h.pop();return b}return h.yStack[f]}function d(b){if(h.count>h.maxStackDepth)throw Error("Stack depth exceeded: "+h.stackMaxDepth+"!");switch(a.getType(b)){case "Object":return c(b,Object.create(b));case "Array":for(var f=[],e=0;e<b.length;e++)f[e]=d(b[e]);return f;case "RegExp":return c(b,new RegExp(b));case "Date":return c(b,new Date(b.toString()));default:return b}}var f=-1,h=new e(1E3);return d(b)};a.equals=function(b,c){function d(a,b){var c=Object.keys(a),d=Object.keys(b);if(!f(c,d))return!1;
h.push(a,b);for(var e in a)if(!f(a[e],b[e]))return!1;h.pop();return!0}function f(b,c){if(h.count>h.maxStackDepth)throw Error("Stack depth exceeded: "+h.maxStackDepth+"!");if(b===c)return!0;var e=a.getType(b),g=a.getType(c);if(e!==g)return!1;if(-1!==h.xStack.indexOf(b)&&-1!==h.yStack.indexOf(c))return!0;switch(e){case "Date":if(b.getTime()!==c.getTime()||!d(b,c))return!1;break;case "Function":if(b.toString()!==c.toString())return!1;break;case "Array":if(b.length!==c.length)return!1;h.push(b,c);for(e=
0;e<b.length;e++)if(!f(b[e],c[e]))return!1;h.pop();break;case "Object":case "RegExp":if(!d(b,c))return!1;break;default:if(b!==c)return!1}return!0}var h=new e(1E3);return f(b,c)};a.sizeof=function(a){var c=[];a=[a];for(var d=0;a.length;){var f=a.pop();if("boolean"===typeof f)d+=4;else if("string"===typeof f)d+=2*f.length;else if("number"===typeof f)d+=8;else if("object"===typeof f&&-1===c.indexOf(f))for(i in c.push(f),f)a.push(f[i])}return d};a.lambda=function(b){if(null==b)return a.functions.identity;
if(a.getType(b)===a.types["function"])return b;if(a.getType(b)===a.types.string){if(a.equals(b,""))return a.functions.identity;if(-1<b.indexOf("=>")){var c=b.match(a.functions.matcher);return(new Function(c[1]||[],"return "+c[2]+";")).bind(arguments.callee.caller)}throw Error("Error: Expression was not a valid lambda!");}};(function(){a.functions={identity:function(a){return a},"true":function(a){return!0},"false":function(a){return!1},empty:function(a){},matcher:/^(?:[(\s*]*)?(\w+(?:,\s*\w+)*)?(?:[)\s*]*)?=>(?:\s*)?(.*)$/};
a.types={array:a.getType([]),"boolean":a.getType(!0),date:a.getType(new Date),"function":a.getType(function(){}),"null":a.getType(null),number:a.getType(0),object:a.getType({}),string:a.getType(""),regexp:a.getType(RegExp()),undefined:a.getType(q)}})();g.util=a})(window||this);
(function(g,q){var a=g.util||{},e=function(){};e.argsNotNull=function(){a.assert(function(){for(var a=0;a<arguments.length;a++)if(null==arguments[a])return!1;return!0});return!0};e.exists=function(b){a.assert(function(){return null!=b});return!0};e.isArray=function(b){a.assert(function(){return a.getType(b)===a.types.array});return!0};e.isBoolean=function(b){a.assert(function(){return a.getType(b)===a.types["boolean"]});return!0};e.isFunction=function(b){a.assert(function(){return a.getType(b)===
a.types["function"]});return!0};e.isNumber=function(b){a.assert(function(){return!isNaN(b)});return!0};e.isObject=function(b){a.assert(function(){return a.getType(b)===a.types.object});return!0};e.isReference=function(b){a.assert(function(){a.getType(b);return valType===a.types.object||valType===a.types.array||valType===a.types.date||valType===a.types.regexp||valType===a.types["function"]});return!0};e.isString=function(b){a.assert(function(){return a.getType(b)===a.types.string});return!0};e.isType=
function(b,c){a.assert(function(){return a.getType(b)===c});return!0};e.isValue=function(b){a.assert(function(){var c=a.getType(b);return c===a.types.string||c===a.types["boolean"]||c===a.types.number||c===a.types["null"]||c===a.types.undefined});return!0};a.check=e;g.util=a})(window||this);
(function(g,q){var a=g.util||{},e={},b;e.build=function(b){a.check.isObject(b);a.check.isArray(b.Tables);b=b.Tables.orderBy("x => x.TableName");for(var d=0;d<b.length;d++)e.makeTable(b[d])};e.makeTable=function(c){a.check.isObject(c);a.check.isString(c.TableName);a.check.isArray(c.PrimaryKeys);a.check.isArray(c.ForeignKeys);var d=[],f=[],h=[],k=[];switch(b){case "sqlite":d.push("CREATE TABLE IF NOT EXISTS "+c.TableName+" (");for(var g=0;g<c.Columns.length;g++){var m=c.Columns[g],p=e.types[m.DataType][b],
p=p.length?p.type+"("+p.length+")":p.type;0===g?f.push("    "+m.ColumnName+" "+p+(m.IsNullable?"":" NOT NULL")):f.push(m.ColumnName+" "+p+(m.IsNullable?"":" NOT NULL"))}f=f.join("\n    , ");d.push(f);k.push("    , PRIMARY KEY (");for(g=0;g<c.PrimaryKeys.length;g++)h.push(c.PrimaryKeys[g].ColumnName);k.push(h.join(", "));k.push(")");c=k.join("");d.push(c);d.push(")");d.join("\n")}};e.load=function(c,d,f){a.check.isString(c);a.check.isString(d);a.check.isNumber(f);b=d.toLowerCase();switch(b){case "sqlite":openDatabase(c,
"0.1",c,f)}};e.types={bit:{sqlite:{type:"INTEGER"}},"char":{sqlite:{type:"TEXT"}},datetime:{sqlite:{type:"TEXT"}},datetime2:{sqlite:{type:"TEXT"}},decimal:{sqlite:{type:"REAL"}},"float":{sqlite:{type:"REAL"}},"int":{sqlite:{type:"INTEGER"}},money:{sqlite:{type:"REAL"}},nvarchar:{sqlite:{type:"TEXT"}},smallint:{sqlite:{type:"INTEGER"}},smallmoney:{sqlite:{type:"REAL"}},text:{sqlite:{type:"TEXT"}},tinyint:{sqlite:{type:"INTEGER"}},varchar:{sqlite:{type:"TEXT"}},uniqueidentifier:{sqlite:{type:"CHAR",
length:36},mssql:{type:"uniqueidentifier"}}};a.db=e;g.util=a})(window||this);(function(g,q){var a=g.util||{},e={};Object.defineProperties(e,{parameters:{get:function(){var a={},c=window.location.href,d=c.indexOf("?");if(-1<d)for(c=c.substring(d+1).split("&"),d=0;d<c.length;d++){var f=c[d].split("=");2==f.length&&(a[f[0]]=decodeURIComponent(f[1].replace(/\+/g," ")))}return a},set:function(a){throw Error("location.parameters setter is not accessible!");}}});a.location=e;g.util=a})(window||this);
(function(g,q){var a=g.util||{},e=function(){function b(a){this.setLogger(a);this.setDebugLogging(!1)}var c=["debug","error","info","log","warn"],d=function(){this._debug=this.logger.debug.bind(this.logger);this._error=this.logger.error.bind(this.logger);this._info=this.logger.info.bind(this.logger);this._log=this.logger.log.bind(this.logger);this._warn=this.logger.warn.bind(this.logger)},f=function(){Object.defineProperty(b.prototype,"debug",{get:function(){return this.useDebugLogging?this._debug:
a.functions.empty}});Object.defineProperty(b.prototype,"error",{get:function(){return this._error}});Object.defineProperty(b.prototype,"info",{get:function(){return this._info}});Object.defineProperty(b.prototype,"log",{get:function(){return this._log}});Object.defineProperty(b.prototype,"warn",{get:function(){return this._warn}})};b.prototype.setDebugLogging=function(a){this.useDebugLogging=a};b.prototype.setLogger=function(b){a.check.exists(b);for(var e=0;e<c.length;e++)a.check.isFunction(b[c[e]]);
this.logger=b;d.apply(this);f()};return b}();a.log=new e(console);g.util=a})(window||this);
(function(g,q){var a=g.util||{};a.match=function(e,b){var c=[];if(!b||a.getType(b)!==a.types.object||!e||a.getType(e)!==a.types.array||1>e.length)return c;var d=Object.keys(b).length;if(1>d)return c;for(var f,h=0;h<e.length;h++){f=0;for(var k in b){var g;g=e[h][k];var m=b[k];if(a.getType(g)===a.types.array){a.getType(m)!==a.types.array&&(m=[m]);b:{for(var p=0;p<m.length;p++)if(-1===$.inArray(m[p],g)){g=!1;break b}g=!0}}else g=g===m;g&&f++}f===d&&c.push(e[h])}return c};g.util=a})(window||this);
(function(g,q){var a=g.util||{},e=function(){return a.deepCopy(this)},b=function(b){return a.equals(this,b)};(function(){var a=function(a){null==a.proto[a.name]?Object.defineProperty(a.proto,a.name,{enumerable:!1,writable:!1,value:a.func}):console.error("Error: the method "+a.name+" has already been defined on the following prototype: "+a.proto)};a({proto:Object.prototype,name:"deepCopy",func:e});a({proto:Object.prototype,name:"equals",func:b})})();g.util=a})(window||this);
(function(g,q){function a(a){var b=new e,h=a||"";this.stop=function(){b.stop();c.debug(h+" took: "+b.duration()+" ms")};b.start()}function e(){var a=null,b=null,c=!1;this.start=function(){c||(b=null,c=!0,a=(new Date).getTime())};this.stop=function(){c&&(b=(new Date).getTime(),c=!1)};this.duration=function(){return c?(new Date).getTime()-a:b-a};this.reset=function(){c=!1;b=a=null}}var b=g.util||{},c=b.log;b.sw=function(){};b.sw.stopwatches=[];b.sw.push=function(c){b.sw.stopwatches.push(new a(c))};
b.sw.pop=function(){0<b.sw.stopwatches.length&&b.sw.stopwatches.pop().stop()};g.util=b})(window||this);
